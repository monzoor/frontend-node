!function($){$.fn.searchBar=function(){var $container=this,$input=this.find("input").eq(0),$tip=this.find(".search__tip"),_tipShowing=!1,_seenTipCookie="ekhanei.seensearchtip",_cookieDuration=365,init=function(){$input.on("focus",function(){open()}),$container.on("click","[data-action=clear]",function(e){e.preventDefault(),clearSearch()})},open=function(){$container.addClass("active"),$tip.on("click",function(e){e.stopPropagation()}),window.getCookie(_seenTipCookie)||showTip(),setTimeout(function(){$(document).on("click",close),$container.on("click",function(e){e.stopPropagation()})},100)},close=function(){$container.removeClass("active"),hideTip(),$(document).off("click",close),$container.off("click")},clearSearch=function(){var categoryInput=$container.find("input[name=cat]"),category=categoryInput.length?categoryInput.val():null;category?window.location.href="/?cat="+category:window.location.href="/"},showTip=function(){_tipShowing||(setTimeout(function(){$tip.hide().removeClass("hidden").fadeIn(200).on("click",".close",function(){hideTip(!0)})},200),_tipShowing=!0)},hideTip=function(persist){_tipShowing&&("undefined"!=typeof persist&&persist&&window.setCookie(_seenTipCookie,1,_cookieDuration),$tip.fadeOut(100,function(){$tip.addClass("hidden")}),_tipShowing=!1)};init()}}(window.jQuery),function($,validate){$.fn.postAdForm=function(options){options||(options={}),$.extend(options,{});var $container=this,$fields={description:this.find("[name=description]"),price:this.find("[name=price]"),location:this.find("[name=address]"),category:this.find("[name=category]"),title:this.find("[name=title]")},$form=$container.find("#adInsertForm"),$placeholder=$fields.description.next(),$photos=$container.find(".photos").eq(0),$files=$photos.find("input[type=file]"),_open=!1,_gaEventCategory="Ad Insertion",_fileApiSupport=window.File&&window.FileReader&&window.FileList&&window.Blob,_constraints={description:{presence:!0,length:{minimum:2,maximum:500}},price:{presence:!0,numericality:{onlyInteger:!0,greaterThan:0},length:{minimum:1,maximum:10}},location:{presence:!0},category:{presence:!0}},init=function(){for(var k in $fields){var $field=$fields[k];$field.data("initialValue",$field.val())}return $fields.description.on("click",open),$fields.description.on("keydown keyup",layoutDescription),$(this).find(".upload-photos").hasClass("renew")&&(_open=!0,renew($files)),$form.on("submit",function(e){e.preventDefault(),_open?submitAd():open()}),$files.on("change",handleFileSelect),this},isPrintableKey=function(keycode){return keycode>47&&keycode<58||32==keycode||13==keycode||keycode>64&&keycode<91||keycode>95&&keycode<112||keycode>185&&keycode<193||keycode>218&&keycode<223},layoutDescription=function(e){var value=$fields.description.val();isPrintableKey(e.keyCode)?$placeholder.addClass("hidden"):value||$placeholder.removeClass("hidden")},isDirty=function(){var dirty=!1;for(var key in $fields){var $field=$fields[key];if($field.val()!==$field.data("initialValue")){dirty=!0;break}}return $files.each(function(){if($(this).data("hasPhoto"))return void(dirty=!0)}),dirty},handleFileSelect=function(e){var $file=$(this),$photo=$file.parent().parent();if(_fileApiSupport){var files=e.target.files;if(0===files.length)return;var file=files[0];if(!file.type.match("image.*"))return;var reader=new FileReader;reader.onload=function(e){$photo.addClass("preview").find(".preview").css("background-image","url("+e.target.result+")"),$file.data("hasPhoto",!0),$photo.find("button.cancel").on("click",function(e){e.preventDefault();var $photo=$(this).parent().parent();removePhoto($photo),$file.data("hasPhoto",!1)}),clearError($photos)},reader.readAsDataURL(file)}trackEvent("Select Photo",null,null)},removePhoto=function(photo){var $file=photo.find("input").eq(0);photo.hasClass("preview")&&($file.val(""),photo.removeClass("preview").find(".preview").attr("style",""),trackEvent("Remove Photo",null,null))},renew=function($files){$files.each(function(){var bgHolder=$(this).parents().eq(0).next(".preview");"none"!=bgHolder.css("background-image")&&bgHolder.find("button.cancel").on("click",function(e){e.preventDefault();var $photo=$(this).parent().parent();$photo.find("input[name=images]").remove(),removePhoto($photo)})})},open=function(){_open||($container.removeClass("closed"),$fields.description.focus(),setTimeout(function(){0===$fields.title.length&&$(document).on("click",close),$container.on("click",function(e){e.stopPropagation()})},100),_open=!0,trackEvent("Open Form",null,null))},close=function(){_open&&(isDirty()||($container.addClass("closed"),clearAllErrors(),$(document).off("click",close),$container.off("click"),_open=!1,trackEvent("Close Form",null,null)))},showError=function(field,message){var $error=null;field.data("error")?$error=field.next(".error").eq(0):($error=$('<span class="error">test</span>'),$error.appendTo(field.parent())),$error.html(message),field.data("error",!0);var eventName=field.is("select")?"change":"keydown",clearEvent=function(){clearError(field),field.off(eventName,clearEvent)};field.on(eventName,clearEvent)},clearError=function(field){field.data("error")&&(field.parent().find(".error").remove(),field.data("error",!1))},clearAllErrors=function(){for(var name in $fields){var $field=$fields[name];clearError($field)}clearError($photos)},validatePhotos=function(){var hasPhoto=!1;if($files.each(function(){var bgHolder=$(this).parents().eq(0).next(".preview");if(""!==$(this).val()||"none"!=bgHolder.css("background-image"))return void(hasPhoto=!0)}),!hasPhoto){var error="You must upload at least 1 photo";return showError($photos,error),!1}return!0},validateForm=function(){var data={description:$fields.description.val(),price:$fields.price.val().replace(/\s/g,""),location:$fields.location.val(),category:$fields.category.val()};0!==$fields.title.length&&(data.title=$fields.title.val(),_constraints.title={presence:!0,length:{minimum:1,maximum:70}});var errors=validate(data,_constraints);if(errors)for(var name in errors){var message=errors[name][0],field=$fields[name];showError(field,message)}var photoErrors=validatePhotos();return!(errors||!photoErrors)},validateFilter=function(){var valueNotPresent;return $("#metaFields .field").each(function(){var slug=$(this).attr("id"),dom=$('[name="filters['+slug+']"]'),fieldsValue=parseInt(dom.val());null!==fieldsValue&&""!==fieldsValue&&isNaN(fieldsValue)!==!0||(valueNotPresent=!0),valueNotPresent?(dom.parent().find(".error").remove(),dom.parent().append("<span class='error'>This field can't be blank</span>")):dom.parent().find(".error").remove()}),!valueNotPresent&&"undefined"==typeof valueNotPresent},submitAd=function(){validateFilter()&&validateForm()&&(Ekhanei.loggedIn?($container.addClass("loading"),trackEvent("Submit Form",null,function(){$form[0].submit()})):window.authenticate({flow:"ad-insertion",success:function(overlay){overlay.close(),$container.addClass("loading"),trackEvent("Submit Form","User authed in process",function(){$form[0].submit()})}}))},trackEvent=function(action,label,callback){"undefined"!=typeof ga&&ga("send",{hitType:"event",eventCategory:_gaEventCategory,eventAction:action,eventLabel:label,hitCallback:callback})};return this.init=init,this.open=open,this.init()}}(window.jQuery,window.validate),function($){$.fn.lazyLoad=function(custom){var self=this,defaults={initLoad:0,afterLoaded:function(){this.addClass("bg-loaded")}},settings=$.extend({},defaults,custom);initImageLoad=function(index,value){return index<settings.initLoad&&void value.removeAttr("data-src")},detectBgImgLoaded=function(value){var $this=value,bgImgs=$this.css("background-image").split(", ");$this.data("loaded-count",0),$.each(bgImgs,function(key,value){var img=value.replace(/^url\(["']?/,"").replace(/["']?\)$/,"");$("<img/>").attr("src",img).load(function(){$(this).remove(),$this.data("loaded-count",$this.data("loaded-count")+1),$this.data("loaded-count")>=bgImgs.length&&settings.afterLoaded.call($this)})})},onScrollImgLoad=function(value){value.each(function(){var t=$(this);!t.hasClass("loaded")&&t.offset().top<$(window).scrollTop()+$(window).height()&&(t.css("background-image","url("+t.attr("data-src")+")"),detectBgImgLoaded(t))})},self.each(function(index){initImageLoad(index,$(this))}),$(window).scroll(function(){onScrollImgLoad(self)}),onScrollImgLoad(self)}}(window.jQuery),function($){$.fn.filters=function(options){this.defaultOptions={reset:!1};var title,id,settings=$.extend({},this.defaultOptions,options),queryString=window.location.search,$multipleOptionDom=$(this),$selectedItems=$(".select-multiple--selected ul"),splitQueryString=function(qs){var string,name,value,strings=qs.slice(1).split("&");strings.map(function(v){if(string=v.split("="),name=string[0],value=string[1],""!==value&&name.search(/(-id)$/g)>-1){var $option=$('select[name="'+name+'"]').find('option[value="'+value+'"]');$option.attr("selected","selected")}""!==value&&name.search(/(-ids)$/g)>-1&&!settings.reset&&setCurrentValuesForMultiSelect(name,value)})},setCurrentValuesForMultiSelect=function(name,value){$multipleOptionDom.find("#"+name+"-"+value).prop("checked",!0),title=$multipleOptionDom.find("#"+name+"-"+value).next().html(),id=$multipleOptionDom.find("#"+name+"-"+value).attr("id"),showMultipleSelectedItems(title,id)},showMultipleSelectedItems=function(title,id){var _temp="";"undefined"==typeof title&&"undefined"==typeof id?$selectedItems.html(""):_temp='<li id="'+id+'"><span>'+title+'</span><i class="icon-cancel"></i></li>',$selectedItems.append(_temp)},removeMultiSelect=function(){$selectedItems.find(".icon-cancel").on("click",function(e){e.preventDefault(),id=$(this).parent().attr("id"),$multipleOptionDom.find("#"+id).prop("checked",!1);var $this=$(this);setTimeout(function(){$this.parent().remove()},50)})},changeMultipleBrand=function(){$multipleOptionDom.find("input").on("change",function(){title=$(this).next().html(),id=$(this).attr("id"),$(this).is(":checked")?(showMultipleSelectedItems(title,id),removeMultiSelect()):$selectedItems.find("#"+id).remove("#"+id)})},showHide=function(){$(".select-multiple--headline").on("click",function(){$(this).parent().toggleClass("active")})},init=function(){splitQueryString(queryString),removeMultiSelect(),changeMultipleBrand(),showHide()};queryString&&init()}}(window.jQuery),function($){$.fn.subMenuTemplateCreator=function(options){this.defaultOptions={appearIn:null,callBack:function(){}};var settings=$.extend({},this.defaultOptions,options),$this=this,showSubCategoryFilters=function(dom){var id=dom.find(":selected").data("child"),childId="#"+id,_tempChild=$(childId).html();$(childId).length>0?$(settings.appearIn).html(_tempChild):$(settings.appearIn).html("")},setPreloadedValue=function(){var preLoadedDom=$this.find("option:selected").data("child");preLoadedDom&&(showSubCategoryFilters($this),settings.callBack())},onChangeValue=function(){$this.on("change",function(){showSubCategoryFilters($(this)),settings.callBack()})},init=function(){setPreloadedValue(),onChangeValue()};init()}}(window.jQuery),function($){function showSubCategoryFilters(dom){var id=dom.find(":selected").data("child");childId="#"+id,_tempChild=$(childId).html(),$(childId).length>0?$("#showChildMetaFilters").html(_tempChild):$("#showChildMetaFilters").html("")}function showCategoryFilters(dom){var id="#MetaFiledsForCat"+dom.val(),_temp=$(id).html();$(id).length>0?($("#metaFields").html(_temp),$(".parent").val()&&showSubCategoryFilters($(".parent")),$(".parent").on("change",function(){showSubCategoryFilters($(this))})):($("#metaFields").html(""),$("#showChildMetaFilters").html(""))}var postAdForm=$("#postAdForm").postAdForm(),postEditForm=$("#postEditForm").postAdForm();$("#searchBar").searchBar(),$(".category-filter").active(),$("#otherFilters").active(),window.location.href.indexOf("postad=true")!==-1&&(postAdForm.open(),postEditForm.open()),$("#category").val()&&showCategoryFilters($("#category")),$("#category").on("change",function(){showCategoryFilters($(this))});var reset=!1;$("#reset").click(function(){$("#filters :input").not(":button, :submit, :reset, :hidden").each(function(){$(this).attr("value","")}),$("#filters").find("select option:selected").removeAttr("selected"),$(".select-multiple--selected ul").html(""),$("#showMetafilterss").html(""),reset=!0}),$(".other-filter__options").filters(),$(".other-filter__options .multiple").subMenuTemplateCreator({appearIn:"#showMetafilterss",callBack:function(){$(".other-filter__options").filters({reset:reset})}}),aiThankyou=$("#aiThankyou").overlay(),$("#postAnotherAd").on("click",function(e){e.preventDefault(),$("#adInsertForm").find("textarea").trigger("click"),aiThankyou.close()}),$("#survey").on("click",function(){ga("send","event","Ad Insertion","Answer Survey"),aiThankyou.close()}),$(".ad__image-wrapper .image").lazyLoad({afterLoaded:function(){$(this).addClass("loaded").removeAttr("data-src")}})}(window.jQuery);